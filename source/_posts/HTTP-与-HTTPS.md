---
title: HTTP 与 HTTPS
date: 2020-05-05 20:13:08
categories: 
- 理论归纳
tags:
- 计算机网络
- HTTP
- HTTPS
---

# HTTP 与 HTTPS

## HTTP

HTTP协议从小学就开始学，是一种应用层的基于TCP/IP的，无状态的数据传输协议，发送的是明文数据。

### 工作流程

- 根据域名查找DNS获取ip地址
- 与服务器建立TCP连接
- 客户端发送请求至服务器
- 服务器处理客户请求返回响应信息
- 客户端接收响应信息并进行下一步处理

### HTTP请求结构

- 请求行

  - 请求方法method
  - 请求url字段
  - 协议版本

- 请求头

  请求头包含一些常用请求头字段记录和客户端的各种信息，如Cookie就是被组合在请求头中

- 空行

  只包含回车符和换行符，用于表示请求头截止

- 请求数据

  包含客户端要向服务器提交的数据的键值对

## HTTPS

默认工作在443端口，为了解决HTTP明文传输的安全问题，HTTPS协议在HTTP协议基础上加入了SSL层，通过加密传输与身份认证保证安全性。可以视HTTPS为包装在SSL/TLS协议下的HTTP。

使用HTTPS需要在服务端配置私钥与证书

如nginx证书的key（私钥）与pem（证书）文件

ssl证书可以由受信任的数字证书颁发机构颁发，也可以自行签发，主要包括如颁发者信息，签名，指纹，有效期，申请者信息，公钥加密算法，公钥一类的服务端身份信息。

### SSL协议

安全套接字协议，为网络通信提供数据加密与完整性检验

- 握手协议：客户端与服务器的相互验证，协商加密算法与交换密钥
- 记录协议：提供加密传输与完整性验证
- 警报协议：发现错误报警发现致命错误删除相关信息后关闭连接

### TLS协议

安全传输层协议，基于SSL3.0，与SSL3.0加密方式不同，可以视为升级版的SSL

HTTPS协议同时采取了对称加密与非对称加密



### 工作流程

- 客户端向服务器443端口发送握手协议HTTP请求
- 服务器收到请求后将其证书发送给客户端
- 客户端收到证书后进行合法性验证
- 验证完毕后客户端根据证书中的公钥生成一个密钥，之后将使用密钥将要传输的数据进行加密发送给服务器
- 服务器收到客户端密文后根据私钥将密钥进行解密
- 使用解密后的密钥加密响应数据发送给客户端
- 客户端根据密钥进行堆成解密

### 验证证书合法性

受信任的权威机构的根证书会内嵌在浏览器中

- 浏览器在收到证书后会首先寻找目标颁发机构的根证书
- 根据根公钥解密目标证书的数字签名
- 解密后得到指纹（证书的hash值）和指纹算法
- 根据指纹算法去计算出当前证书的hash值
- 对比指纹与当前hash值是否相同
- 相同则继续检查url和先前请求url是否相同
- 若相同则证书合法



