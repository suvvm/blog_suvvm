---
title: 数据库事务
date: 2020-04-17 21:39:19
categories: 
- 理论归纳
tags:
- 事务
- 数据库
---

# 数据库事务

## 事务的四个特性（ACID）

- 原子性（Atomicity）一个事务要么全部执行完成，要么全部不执行，事务发生错误后会回滚至事务开始前的状态
- 一致性（Consistency）事务只影响数据的状态，事务开始前和结束后数据完整性不变
- 隔离性（Isolation）隔离性是当有多个并发事务对数据进行操作时，事务之间不会相互影响
- 持久性（Durability）事务对数据的修改是持久的，事务一旦提交后数据的改变就是永久的。

## 事务的隔离级别

### 多个事务并发执行可能导致的问题

- 更新丢失

  一个事务开始并对目标数据进行修改，这时有另一个并发事务在第一个事务完成前提交了对目标数据的修改，这时第一个事务回滚，目标数据又回滚到了第一个事务开启前的状态，第二个事务对数据的更新丢失了。

- 脏读

  一个事务读取了另一个事务修改却并未提交的数据，若之后修改数据的事务回滚，则第一个事务读到的便是无效数据。

- 不可重复读

  一个事务读取数据需要读取两次以上，另一个并发事务在第一个事务初次读取数据后提交了对该项数据的修改，导致第一个事务在第二次读取数据时获得的结果不同。

- 幻象读

  一个事务范围性读取需要读取两次以上，另一个并发事务在第一个事务初次范围性读取数据后提交了对插入或删除，导致第一个事务在第二次范围性读取数据获得的数据量与初次读取时不同。

### 事务的隔离级别

- 读未提交（Read uncommitted）

  如果一个事务已经开始更新数据，则另外一个事务不允许并发对第一个事务读取的数据进行更新。

  避免了更新丢失，但无法避免脏读、不可重复读、幻象读。

- 读提交（Read committed）

  读取数据的事务运行时，允许其他事务并发进行对目标数据的访问，但是正在更新数据的事务不允许其他事务并发访问目标数据。

  避免了更新丢失、脏读，但无法避免不可重复读、幻象读。

- 可重复读（Repeatable read）

  读取数据的事务运行时，允许其他事务并发进行对目标数据的读取操作，但禁止其他事务对目标数据的更新，更新数据的事务不允许其他事务并发访问目标数据。

  避免了更新丢失、脏读、不可重复读，但无法避免幻象读。

- 序列化（Serializable）

  禁止事务并发，所有事务串行化执行。

  没有并发，所有问题迎刃而解，但是效率低下。

  